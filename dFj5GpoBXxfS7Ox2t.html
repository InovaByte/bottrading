<html><head><base href="https://www.binance.com/"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Analisador de Mercado de Criptomoedas</title><style>
body {
    font-family: 'Roboto', sans-serif;
    background-color: #f0f2f5;
    margin: 0;
    padding: 20px;
    color: #333;
}
.container {
    max-width: 1000px;
    margin: 0 auto;
    background-color: #fff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
h1, h2 {
    color: #f0b90b;
    text-align: center;
}
.chart-container {
    width: 100%;
    height: 400px;
    margin-bottom: 20px;
}
.controls {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
}
button, select {
    background-color: #f0b90b;
    border: none;
    color: white;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.3s;
}
button:hover, select:hover {
    background-color: #d4a508;
}
select {
    background-color: white;
    color: #333;
    border: 1px solid #f0b90b;
}
#signalContainer {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 4px;
    padding: 15px;
    margin-top: 20px;
}
#signalContainer h3 {
    margin-top: 0;
    color: #f0b90b;
}
.signal-item {
    background-color: white;
    border: 1px solid #e9ecef;
    border-radius: 4px;
    padding: 10px;
    margin-bottom: 10px;
}
.signal-item h4 {
    margin-top: 0;
    color: #f0b90b;
}
.buy {
    border-left: 5px solid #28a745;
}
.sell {
    border-left: 5px solid #dc3545;
}
#newsContainer {
    margin-top: 20px;
}
.news-item {
    background-color: white;
    border: 1px solid #e9ecef;
    border-radius: 4px;
    padding: 10px;
    margin-bottom: 10px;
}
.news-item h4 {
    margin-top: 0;
    color: #f0b90b;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Analisador de Mercado de Criptomoedas</h1>
        <div class="controls">
            <select id="symbolSelect">
                <option value="BTCUSDT">Bitcoin (BTC/USDT)</option>
                <option value="ETHUSDT">Ethereum (ETH/USDT)</option>
                <option value="BNBUSDT">Binance Coin (BNB/USDT)</option>
                <option value="ADAUSDT">Cardano (ADA/USDT)</option>
                <option value="DOGEUSDT">Dogecoin (DOGE/USDT)</option>
            </select>
            <button id="startBtn">Iniciar Análise</button>
            <button id="stopBtn">Parar Análise</button>
        </div>
        <div class="chart-container">
            <canvas id="priceChart"></canvas>
        </div>
        <div id="signalContainer">
            <h3>Sinais de Trading</h3>
            <!-- Sinais serão inseridos aqui dinamicamente -->
        </div>
        <div id="newsContainer">
            <h2>Notícias Relevantes</h2>
            <!-- Notícias serão inseridas aqui dinamicamente -->
        </div>
    </div>

<script>
let symbol = 'BTCUSDT';
const interval = '15m';
let isAnalyzing = false;
let chart;
let ws;

// Função para inicializar o gráfico
function initChart() {
    const ctx = document.getElementById('priceChart').getContext('2d');
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Preço',
                data: [],
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Tempo'
                    }
                },
                y: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Preço (USDT)'
                    }
                }
            }
        }
    });
}

// Função para atualizar o gráfico
function updateChart(price, time) {
    if (chart.data.labels.length > 100) {
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
    }
    
    chart.data.labels.push(new Date(time).toLocaleTimeString());
    chart.data.datasets[0].data.push(price);
    chart.update();
}

// Função para calcular indicadores
function calculateIndicators(prices) {
    // Implementação simplificada dos indicadores
    const sma20 = prices.slice(-20).reduce((sum, price) => sum + price, 0) / 20;
    const sma50 = prices.slice(-50).reduce((sum, price) => sum + price, 0) / 50;
    
    const rsi = (prices) => {
        const changes = prices.slice(1).map((price, index) => price - prices[index]);
        const gains = changes.map(change => change > 0 ? change : 0);
        const losses = changes.map(change => change < 0 ? -change : 0);
        const avgGain = gains.reduce((sum, gain) => sum + gain, 0) / 14;
        const avgLoss = losses.reduce((sum, loss) => sum + loss, 0) / 14;
        const rs = avgGain / avgLoss;
        return 100 - (100 / (1 + rs));
    };

    return {
        sma20,
        sma50,
        rsi: rsi(prices.slice(-15))
    };
}

// Função para gerar sinal de trading
function generateSignal(price, indicators, newsData) {
    const {sma20, sma50, rsi} = indicators;
    const lastPrice = price;
    
    let signal = null;
    let explanation = "";
    let leverage = 1;
    let stopLoss = 0;
    let takeProfit = 0;

    // Lógica de decisão
    if (lastPrice > sma20 && sma20 > sma50 && rsi < 70) {
        signal = "compra";
        explanation = "O preço está acima das médias móveis de 20 e 50 períodos, indicando uma tendência de alta. O RSI abaixo de 70 sugere que o ativo ainda não está sobrecomprado.";
        leverage = 2;
        stopLoss = lastPrice * 0.98;
        takeProfit = lastPrice * 1.05;
    } else if (lastPrice < sma20 && sma20 < sma50 && rsi > 30) {
        signal = "venda";
        explanation = "O preço está abaixo das médias móveis de 20 e 50 períodos, indicando uma tendência de baixa. O RSI acima de 30 sugere que o ativo ainda não está sobrevendido.";
        leverage = 2;
        stopLoss = lastPrice * 1.02;
        takeProfit = lastPrice * 0.95;
    }

    // Adicionar análise de notícias à explicação
    if (newsData && newsData.length > 0) {
        const relevantNews = newsData[0];
        explanation += ` Além disso, uma notícia recente "${relevantNews.title}" pode impactar o mercado.`;
    }

    if (signal) {
        return {
            direction: signal,
            explanation,
            leverage,
            stopLoss: stopLoss.toFixed(2),
            takeProfit: takeProfit.toFixed(2),
            time: new Date().toLocaleString()
        };
    }

    return null;
}

// Função para exibir sinal
function displaySignal(signal) {
    const signalContainer = document.getElementById('signalContainer');
    const signalElement = document.createElement('div');
    signalElement.className = `signal-item ${signal.direction}`;
    signalElement.innerHTML = `
        <h4>Sinal de ${signal.direction.toUpperCase()}</h4>
        <p><strong>Explicação:</strong> ${signal.explanation}</p>
        <p><strong>Alavancagem sugerida:</strong> ${signal.leverage}x</p>
        <p><strong>Stop Loss:</strong> ${signal.stopLoss} USDT</p>
        <p><strong>Take Profit:</strong> ${signal.takeProfit} USDT</p>
        <p><strong>Hora do sinal:</strong> ${signal.time}</p>
    `;
    signalContainer.insertBefore(signalElement, signalContainer.firstChild);
}

// Função para buscar notícias
async function fetchNews() {
    try {
        const response = await axios.get('https://newsapi.org/v2/everything', {
            params: {
                q: symbol.slice(0, -4), // Remove USDT do símbolo
                apiKey: 'YOUR_NEWS_API_KEY', // Substitua pela sua chave de API
                language: 'pt',
                sortBy: 'publishedAt',
                pageSize: 5
            }
        });
        return response.data.articles;
    } catch (error) {
        console.error('Erro ao buscar notícias:', error);
        return [];
    }
}

// Função para exibir notícias
function displayNews(newsData) {
    const newsContainer = document.getElementById('newsContainer');
    newsContainer.innerHTML = '<h2>Notícias Relevantes</h2>';
    newsData.forEach(news => {
        const newsElement = document.createElement('div');
        newsElement.className = 'news-item';
        newsElement.innerHTML = `
            <h4>${news.title}</h4>
            <p>${news.description}</p>
            <a href="${news.url}" target="_blank">Leia mais</a>
        `;
        newsContainer.appendChild(newsElement);
    });
}

// Função principal de análise
async function startAnalysis() {
    if (!isAnalyzing) return;

    try {
        const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=50`);
        const data = await response.json();
        const prices = data.map(candle => parseFloat(candle[4])); // Preço de fechamento

        // Buscar notícias
        const newsData = await fetchNews();
        displayNews(newsData);

        // Iniciar WebSocket para receber atualizações de preço em tempo real
        if (ws) {
            ws.close();
        }
        ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol.toLowerCase()}@kline_${interval}`);

        ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            const price = parseFloat(message.k.c);
            const time = message.k.t;

            updateChart(price, time);
            prices.push(price);
            if (prices.length > 50) prices.shift();

            const indicators = calculateIndicators(prices);
            const signal = generateSignal(price, indicators, newsData);

            if (signal) {
                displaySignal(signal);
            }
        };

        ws.onerror = (error) => {
            console.error('Erro no WebSocket:', error);
            isAnalyzing = false;
        };

        ws.onclose = () => {
            console.log('Conexão WebSocket fechada');
            isAnalyzing = false;
        };

    } catch (error) {
        console.error('Erro ao iniciar a análise:', error);
        isAnalyzing = false;
    }
}

// Event listeners
document.getElementById('startBtn').addEventListener('click', () => {
    if (!isAnalyzing) {
        isAnalyzing = true;
        console.log('Iniciando análise...');
        startAnalysis();
    }
});

document.getElementById('stopBtn').addEventListener('click', () => {
    if (isAnalyzing) {
        isAnalyzing = false;
        if (ws) ws.close();
        console.log('Parando análise...');
    }
});

document.getElementById('symbolSelect').addEventListener('change', (event) => {
    symbol = event.target.value;
    console.log(`Símbolo alterado para ${symbol}`);
    if (isAnalyzing) {
        isAnalyzing = false;
        if (ws) ws.close();
        setTimeout(() => {
            isAnalyzing = true;
            startAnalysis();
        }, 1000);
    }
});

// Inicialização
initChart();
</script>
</body></html>